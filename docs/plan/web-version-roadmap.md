# WeChatBot Web 版开发计划

> 定位：单机版微信 Web 模拟器，用于调试人设和对话效果

## 开发进度

| 阶段 | 功能 | 状态 | 完成日期 |
|------|------|------|----------|
| **Phase 1** | 配置菜单（统一入口） | ✅ 完成 | 2024-11-27 |
| Phase 1 | 主动消息功能（定时器） | ✅ 完成 | 2024-11-27 |
| Phase 1 | 安静时间设置 | ✅ 完成 | 2024-11-27 |
| Phase 2 | 核心记忆（独立文件） | ✅ 完成 | 2024-11-27 |
| Phase 2 | 记忆评分（重要度+时间衰减） | ✅ 完成 | 2024-11-27 |
| Phase 3 | 表情回复 | ✅ 完成 | 2024-11-27 |
| Phase 3 | 图片识别 | ✅ 完成 | 2024-11-27 |
| Phase 3 | 联网搜索 | ✅ 完成 | 2024-11-27 |
| 额外 | 数据导出功能 | ✅ 完成 | 2024-11-27 |
| 额外 | 特殊指令 [tickle_self] | ✅ 完成 | 2024-11-27 |

## 已完成功能

- ✅ 智能对话（DeepSeek/GPT 等大模型）
- ✅ 角色扮演（自定义人设 Prompt）
- ✅ 消息分段（支持 `\` 分隔）
- ✅ 拍一拍 `[tickle]` / `[tickle_self]`
- ✅ 撤回消息 `[recall]`
- ✅ 打字效果
- ✅ 自动记忆整理
- ✅ 导入配置（config.py + .md 人设）
- ✅ 导出数据（聊天记录、人设、配置）
- ✅ 主题切换
- ✅ 头像设置
- ✅ 主动消息（定时器触发）
- ✅ 安静时间
- ✅ 核心记忆管理
- ✅ 记忆评分系统
- ✅ 表情回复
- ✅ 图片识别（视觉模型）
- ✅ 联网搜索

## 不实现功能

- ❌ 群聊功能
- ❌ 微信消息收发
- ❌ 语音通话
- ❌ 角色论坛

---

## Phase 1 详细设计

### 1.1 配置菜单（统一入口）

将所有配置整合到设置弹窗，包含：

- 个人设置（头像、昵称）
- API 配置
- 模型参数
- 主题皮肤
- **主动消息设置**（新增）
- **安静时间设置**（新增）

### 1.2 主动消息功能

```typescript
interface AutoMessageConfig {
  enabled: boolean           // 是否启用
  minInterval: number        // 最小间隔（分钟）
  maxInterval: number        // 最大间隔（分钟）
  prompt: string             // 触发提示词
}
```

逻辑：

1. 用户发送消息后启动计时器
2. 在 minInterval~maxInterval 随机时间后触发
3. 调用 AI 生成主动消息
4. 检查安静时间，如在安静时间内则跳过

### 1.3 安静时间设置

```typescript
interface QuietTimeConfig {
  enabled: boolean
  startTime: string  // "22:00"
  endTime: string    // "08:00"
}
```

---

## Phase 2 详细设计

### 2.1 核心记忆

独立于聊天记录的持久化记忆，包含：

- 用户信息（姓名、生日、喜好）
- 重要事件
- 长期记忆

### 2.2 记忆评分

公式：`score = 0.6 * importance - 0.4 * (hours_since_created)`

- importance: 1-5 重要度
- hours_since_created: 存在时间（小时）

---

## Phase 3 详细设计

### 3.1 表情回复

AI 回复中包含 `[emoji:xxx]` 标记时，显示对应表情

### 3.2 图片识别

支持粘贴/上传图片，调用视觉模型（GPT-4V/Moonshot）识别

### 3.3 联网搜索

检测需要搜索的问题，调用搜索 API 获取信息
